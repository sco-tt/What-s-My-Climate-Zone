
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="robots" content="follow,index" />
		<meta name="keywords" content="What's my climate zone?" lang="en-us" />
		<meta name="description" content="" />
		<link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
		<title>What's My Climate Zone?</title>
		
		<style type="text/css">
			body, html {
				margin: 0;
				padding: 10px;
				font-family: Verdana;
				font-size: 12px;
				color: #000;
			}
			#map-holder {
				display: block;
				width: 100%;
				height: 450px;
			}
			#text {
				width: 430px;
			}
			#debug {
				position: relative;
				font-size: 11px;
			}
			#zoneOutput {
				font-family: Helvetica;
				font-weight: bold;
				font-size: 2rem;
			}
			.main {
				position: relative;
								max-width: 1400px;

			}
			.results-container {
				width: 100%;
				background-color: rgba(0,0,0,0.5);
				position: absolute;
				top: 0;
				z-index: 999;
				height: 7em;
				color: white;
			}
			.results {
				position: absolute;
				top: .5em;
				left: 2em;
			}
		</style>

		<script language="JavaScript" type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&language=en"></script>
	  <script src="http://yui.yahooapis.com/3.3.0/build/yui/yui-min.js"></script>
		<script language="JavaScript" type="text/javascript">
		
			var map = null;
			
			window.onload = function() {
				
				// initialize the map
				var mapHolder = document.getElementById("map-holder");
				map = new google.maps.Map(
					mapHolder, 
					{
						zoom: 3,
						mapTypeId: google.maps.MapTypeId.ROADMAP
					}
				);
				
				// centering the map
				map.setCenter(new google.maps.LatLng(10.2, 22.1));
				
				// adding events
				document.getElementById("search").onclick = function() {
					var address = document.getElementById("text").value;
					log("Address: " + address, true);
					addressToLocation(address, changeMapLocation);
				}
			
			}
			
			// processing the results
			function changeMapLocation(locations) {
				if(locations && locations.length) {
					log("Num of results: " + locations.length);
					var numOfLocations = locations.length;
					for(var i=0; i<numOfLocations; i++) {	
						log("- " + locations[i].text + " / <strong>" + locations[i].location.toString() + "</strong>");
						var marker = new google.maps.Marker({
							map: map,
							position: locations[i].location
						});
					}
					map.panTo(locations[0].location);
					map.setZoom(5);
					lat = (locations[0].lat).toFixed(2);
					lng = (locations[0].lng).toFixed(2);
						
						//Debug
						console.log("Original lat value is " + lat);
						console.log("Original lng value is " + lng);
					    
					    var latDecimalValue = (lat % 1).toFixed(2);
					    var lngDecimalValue = (lng % 1).toFixed(2);
					    var latRounder;
					    var lngRounder;
					    
					    	//Debug
					    	console.log("Lat Decimal value is " + latDecimalValue);
							  
							  //Round Up to .25
					        if (latDecimalValue >= 0 && latDecimalValue <= 0.25) {
					            latRounder = (0.25 - parseFloat(latDecimalValue,10)).toFixed(2);
						        }
					          //Round Down to .25
					        if (latDecimalValue > 0.25 && latDecimalValue <= 0.5) {
					            latRounder = (0.25 -parseFloat(latDecimalValue,10)).toFixed(2);
					            }
							 //Round Up to .75
					         if (latDecimalValue > 0.5 && latDecimalValue <= 0.75) {
					            latRounder = (0.75 - parseFloat(latDecimalValue,10)).toFixed(2);
					            }
							 //Round down to .75
					          if (latDecimalValue > 0.75 && latDecimalValue < 1) {
					            latRounder = (0.75 - parseFloat(latDecimalValue,10)).toFixed(2);
								}    

					        //Negative Values

					        //Round down to -0.25, i.e. -0.13- becomes -0.25
					        if (latDecimalValue >= -0.25 && latDecimalValue  < 0) {
					             latRounder = (-0.25 - parseFloat(latDecimalValue,10)).toFixed(2);
					            }
					        //Round up to -0.25, i.e. -0.32 beomes -0.25
					        if (latDecimalValue >= -0.5 && latDecimalValue < -0.25) {
					             latRounder = (-0.25 - parseFloat(latDecimalValue,10)).toFixed(2);
					            }
					        //Round down to -0.75
					        if (latDecimalValue >= -0.75 && latDecimalValue < -0.5) {
					            latRounder = (-0.75 - parseFloat(latDecimalValue,10)).toFixed(2);
					       }
					        //Round up to -0.75
					        if (latDecimalValue < -0.75 && latDecimalValue > -1.00) {
					            latRounder = (-0.75 - parseFloat(latDecimalValue,10)).toFixed(2);
					        }

					       /******
					       Longitude
					       ******/ 	

				         //Round Up to .25
				          if (lngDecimalValue >= 0 && lngDecimalValue <= 0.25) {
				              lngRounder = (0.25 - parseFloat(lngDecimalValue,10)).toFixed(2);
				            }
				            //Round Down to .25
				          if (lngDecimalValue > 0.25 && lngDecimalValue <= 0.5) {
				              lngRounder = (0.25 -parseFloat(lngDecimalValue,10)).toFixed(2);
			              }
				       //Round Up to .75
				           if (lngDecimalValue > 0.5 && lngDecimalValue <= 0.75) {
				              lngRounder = (0.75 - parseFloat(lngDecimalValue,10)).toFixed(2);
				              }
					       //Round down to .75
				            if (lngDecimalValue > 0.75 && lngDecimalValue < 1) {
				              lngRounder = (0.75 - parseFloat(lngDecimalValue,10)).toFixed(2);
				        }    

				          //Negative Values
				          
				          //Round down to -0.25, i.e. -0.13- becomes -0.25
				          if (lngDecimalValue >= -0.25 && lngDecimalValue  < 0) {
				               lngRounder = (-0.25 - parseFloat(lngDecimalValue,10)).toFixed(2);
				              }
				          //Round up to -0.25, i.e. -0.32 beomes -0.25
				          if (lngDecimalValue >= -0.5 && lngDecimalValue < -0.25) {
				               lngRounder = (-0.25 - parseFloat(lngDecimalValue,10)).toFixed(2);
				              }
				          //Round down to -0.75
				          if (lngDecimalValue >= -0.75 && lngDecimalValue < -0.5) {
				              lngRounder = (-0.75 - parseFloat(lngDecimalValue,10)).toFixed(2);
				         }
				          //Round up to -0.75
				          if (lngDecimalValue < -0.75 && lngDecimalValue > -1.00) {
				              lngRounder = (-0.75 - parseFloat(lngDecimalValue,10)).toFixed(2);
				          }
									
								//Debug
								console.log("Rounder for lat is: " + latRounder);
								console.log("Rounder for lng is: " + lngRounder);

			            lat = parseFloat(lat,10) + parseFloat(latRounder,10);
			            lng = parseFloat(lng,10) + parseFloat(lngRounder,10);

			            
					            //Debug
					            console.log("New lat value is " + lat);
					            console.log("New lng value is " + lng);
	                      var query = 'select zone from csv where url="https://dl.dropboxusercontent.com/u/68432285/Koeppen-Geiger-ASCII-trimmed.csv" and columns="lat,lng,zone" and lat="'+ lat + '" and lng="' + lng + '"';
                         YUI().use("yql", function (Y) {
                      
                     
                        Y.YQL(query, function(results) {
                            climateZone = results.query.results.row.zone;
                            log(climateZone);
                            var zoneOutput = document.getElementById('zoneOutput');
                            var zoneDescription = document.getElementById('zoneDescription');
							zoneOutput.innerHTML = zoneOutput.innerHTML + climateZone;
                            if (climateZone == "Af") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Tropical rainforest";
                            }   
                            if (climateZone == "Am") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Tropical monsoon";
                            } 
                            if (climateZone == "Aw") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Tropical wet and dry or savanna";
                            }
                            if (climateZone == "As") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Tropical wet and dry or savanna ('summer' dry season)";
                            }
                            if (climateZone == "BWh") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Subtropical desert";
                            }
                            if (climateZone == "BSh") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Subtropical steppe";
                            }
							if (climateZone == "BWk") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Mid-latitude desert";
                            }
                            if (climateZone == "BSk") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Mid-latitude steppe";
                            }            
                            if (climateZone == "Csa") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Mediterranean, hot summer";
                            }  

                            if (climateZone == "Csb") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Mediterranean, warm summer";
                            }                
                            if (climateZone == "Cfa") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Humid subtropical, no dry season";
                            } 
                            if (climateZone == "Cwa") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Humid subtropical, dry winter";
                            } 
                            if (climateZone == "Cwb") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Temperate highland tropical climate with dry winters";
                            } 
                            if (climateZone == "Cwc") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Temperate highland tropical climate with dry winters";
                            } 
                            if (climateZone == "Cfb") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Marine west coast, warm summer";
                            }
                            if (climateZone == "Cfc") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Marine west coast, cool summer";
                            } 
                            //D's
                            if (climateZone == "Dfa") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Humid continental, no dry season, hot summer";
                            }
                            if (climateZone == "Dfb") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Humid continental, no dry season, warm summer";
                            }
							if (climateZone == "Dwa") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Humid continental, severe dry winter, hot summer";
                            }
                            if (climateZone == "Dwb") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Humid continental, severe dry winter, warm summer";
                            }            
                            if (climateZone == "Dfc") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Subartic, severe winter, no dry season, cool summer";
                            }  

                            if (climateZone == "Dfd") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Subartic, severe very cold winter, no dry season, cool summer";
                            }                
                            if (climateZone == "Dwc") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Subartic, dry winter, cool summer";
                            } 
                            if (climateZone == "Dsc") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Subartic, subalpine?";
                            } 
                            if (climateZone == "Dwd") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Subartic, very cold and dry winter, cool summer";
                            } 
                            if (climateZone == "ET") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Tundra";
                            }
                            if (climateZone == "EF") {
                            	zoneDescription.innerHTML = zoneDescription.innerHTML + "Ice Cap";
                            }

                        });
                    });

				} 


				else {
					log("Num of results: 0");
				}
			}
			
			// converting the address's string to a google.maps.LatLng object
			function addressToLocation(address, callback) {
				var geocoder = new google.maps.Geocoder();
				geocoder.geocode(
					{
						address: address
					}, 
					function(results, status) {
						
						var resultLocations = [];
						
						if(status == google.maps.GeocoderStatus.OK) {
							if(results) {
								var numOfResults = results.length;
								for(var i=0; i<numOfResults; i++) {
									var result = results[i];
									resultLocations.push(
										{
											text:result.formatted_address,
											addressStr:result.formatted_address,
											location:result.geometry.location,
											lat:result.geometry.location.lat(),
											lng:result.geometry.location.lng(),
										}
									);
								};
							}
						} else if(status == google.maps.GeocoderStatus.ZERO_RESULTS) {
							// address not found
						}
						
						if(resultLocations.length > 0) {
							callback(resultLocations);
						} else {
							callback(null);
						}
					}
				);
			}

			//start Layers

			var layers = [];
			layers[0] = new google.maps.KmlLayer('http://wmcz.kissr.com/Koeppen-Geiger-GE.kmz',
			{preserveViewport: true});

			//toggle layers
			function toggleLayer(i) {
			  if(layers[i].getMap()==null) {
		     layers[i].setMap(map);
			  }
			  else {
			     layers[i].setMap(null);
			  }
			}
      
			
			// debugging
			function log(str, clear) {
				var debugHolder = document.getElementById("debug");
				if(clear) {
					debugHolder.innerHTML = "";
					zoneDescription.innerHTML = "";
					zoneOutput.innerHTML = "";
				}
				debugHolder.innerHTML = debugHolder.innerHTML + "<br />" + str;
			}
		
		</script>
		
	</head>
	<body>
		<h1>What's my Climate Zone [beta]</h1>
		<input type="text" id="text" />
		<input type="button" id="search" value="search" />
		<div>View Climate Zones <input type="checkbox" id="layer0" onclick="toggleLayer(0)"></div>
		<div class="main">
			<div class="results-container">
				<div class="results">
				<div id="zoneOutput"></div>
				<div id="zoneDescription"></div>
				</div>
			</div>
		</div>

		<div id="map-holder"></div>
		<div id="debug"><h2>Debug</h2></div>

	</body>
</html>